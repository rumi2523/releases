<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>My Releases</title>

<!-- Bootstrap Icons -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">

<style>
:root {
  --bg: #0f0f0f;
  --card-bg: #1a1a1a;
  --accent: #4f46e5;
  --accent-light: #6366f1;
  --text: #f5f5f5;
  --muted: #888;
}

* {
  box-sizing: border-box;
  font-family: system-ui, -apple-system, sans-serif;
}

body {
  margin: 0;
  background: var(--bg);
  color: var(--text);
  display: flex;
  justify-content: center;
  align-items: center;
  height: 100vh;
}

.player {
  width: 95%;
  max-width: 500px;
  background: var(--card-bg);
  border-radius: 16px;
  padding: 25px;
  box-shadow: 0 20px 40px rgba(0,0,0,0.5);
}

.album-art {
  width: 100%;
  height: 220px;
  background: linear-gradient(135deg, #222, #111);
  border-radius: 12px;
  display: flex;
  justify-content: center;
  align-items: center;
  font-size: 50px;
  color: var(--accent);
  margin-bottom: 20px;
}

.track-info {
  text-align: center;
  margin-bottom: 15px;
}

.track-title {
  font-size: 1.2rem;
  font-weight: 600;
}

.time {
  font-size: 0.85rem;
  color: var(--muted);
}

.progress-container {
  width: 100%;
  height: 6px;
  background: #333;
  border-radius: 5px;
  cursor: pointer;
  margin: 10px 0 15px 0;
}

.progress {
  height: 100%;
  width: 0%;
  background: var(--accent);
  border-radius: 5px;
}

.controls {
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 18px;
  margin-bottom: 15px;
}

.controls button {
  background: none;
  border: none;
  color: var(--text);
  font-size: 1.4rem;
  cursor: pointer;
  transition: 0.2s ease;
}

.controls button:hover {
  color: var(--accent-light);
}

.play-btn {
  font-size: 2rem;
  color: var(--accent);
}

.volume-container {
  display: flex;
  align-items: center;
  gap: 10px;
}

.volume-slider {
  width: 100%;
  accent-color: var(--accent);
}

.playlist {
  margin-top: 15px;
  max-height: 120px;
  overflow-y: auto;
  font-size: 0.9rem;
}

.playlist div {
  padding: 6px;
  cursor: pointer;
  border-radius: 6px;
}

.playlist div:hover {
  background: #2a2a2a;
}

.active-track {
  background: var(--accent);
}

@media (max-width: 480px) {
  .album-art { height: 160px; }
}
</style>
</head>

<body>

<div class="player">
  <div class="album-art">
    <i class="bi bi-music-note-beamed"></i>
  </div>

  <div class="track-info">
    <div class="track-title">Loading...</div>
    <div class="time">00:00 / 00:00</div>
  </div>

  <div class="progress-container">
    <div class="progress"></div>
  </div>

  <div class="controls">
    <button id="prev"><i class="bi bi-skip-start-fill"></i></button>
    <button id="backward"><i class="bi bi-arrow-counterclockwise"></i></button>
    <button id="play" class="play-btn"><i class="bi bi-play-circle-fill"></i></button>
    <button id="forward"><i class="bi bi-arrow-clockwise"></i></button>
    <button id="next"><i class="bi bi-skip-end-fill"></i></button>
  </div>

  <div class="volume-container">
    <i class="bi bi-volume-up-fill"></i>
    <input type="range" min="0" max="1" step="0.01" value="1" class="volume-slider">
  </div>

  <div class="playlist"></div>
</div>

<audio id="audio"></audio>

<script>
const audio = document.getElementById("audio");
const playBtn = document.getElementById("play");
const prevBtn = document.getElementById("prev");
const nextBtn = document.getElementById("next");
const forwardBtn = document.getElementById("forward");
const backwardBtn = document.getElementById("backward");
const progressContainer = document.querySelector(".progress-container");
const progress = document.querySelector(".progress");
const title = document.querySelector(".track-title");
const timeDisplay = document.querySelector(".time");
const volumeSlider = document.querySelector(".volume-slider");
const playlistContainer = document.querySelector(".playlist");

let tracks = [];
let currentTrack = 0;

/* Load MP3 Files */
async function loadTracks() {
  try {
    const response = await fetch("/music/tracks.json");
    if (response.ok) {
      tracks = await response.json();
    } else {
      throw new Error();
    }
  } catch {
    const res = await fetch("/music/");
    const text = await res.text();
    const parser = new DOMParser();
    const doc = parser.parseFromString(text, "text/html");
    const links = [...doc.querySelectorAll("a")];
    tracks = links
      .map(link => link.getAttribute("href"))
      .filter(href => href && href.endsWith(".mp3"));
  }

  if (tracks.length > 0) {
    renderPlaylist();
    loadTrack(0);
  } else {
    title.textContent = "No MP3 files found in /music";
  }
}

function loadTrack(index) {
  currentTrack = index;
  audio.src = `/music/${tracks[index]}`;
  title.textContent = tracks[index].replace(".mp3", "");
  highlightActive();
}

function playTrack() {
  audio.play();
  playBtn.innerHTML = '<i class="bi bi-pause-circle-fill"></i>';
}

function pauseTrack() {
  audio.pause();
  playBtn.innerHTML = '<i class="bi bi-play-circle-fill"></i>';
}

function togglePlay() {
  audio.paused ? playTrack() : pauseTrack();
}

function nextTrack() {
  currentTrack = (currentTrack + 1) % tracks.length;
  loadTrack(currentTrack);
  playTrack();
}

function prevTrack() {
  currentTrack = (currentTrack - 1 + tracks.length) % tracks.length;
  loadTrack(currentTrack);
  playTrack();
}

function formatTime(sec) {
  const minutes = Math.floor(sec / 60);
  const seconds = Math.floor(sec % 60).toString().padStart(2, "0");
  return `${minutes}:${seconds}`;
}

audio.addEventListener("timeupdate", () => {
  const percent = (audio.currentTime / audio.duration) * 100;
  progress.style.width = percent + "%";
  timeDisplay.textContent = 
    `${formatTime(audio.currentTime)} / ${formatTime(audio.duration || 0)}`;
});

progressContainer.addEventListener("click", (e) => {
  const width = progressContainer.clientWidth;
  const clickX = e.offsetX;
  audio.currentTime = (clickX / width) * audio.duration;
});

forwardBtn.onclick = () => audio.currentTime += 10;
backwardBtn.onclick = () => audio.currentTime -= 10;
playBtn.onclick = togglePlay;
nextBtn.onclick = nextTrack;
prevBtn.onclick = prevTrack;

volumeSlider.addEventListener("input", () => {
  audio.volume = volumeSlider.value;
});

audio.addEventListener("ended", nextTrack);

function renderPlaylist() {
  playlistContainer.innerHTML = "";
  tracks.forEach((track, index) => {
    const div = document.createElement("div");
    div.textContent = track.replace(".mp3", "");
    div.onclick = () => {
      loadTrack(index);
      playTrack();
    };
    playlistContainer.appendChild(div);
  });
}

function highlightActive() {
  [...playlistContainer.children].forEach((el, i) => {
    el.classList.toggle("active-track", i === currentTrack);
  });
}

loadTracks();
</script>

</body>
</html>
